<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê∏ØÂºèË°åÊóÖ | HK Trip App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@600;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0d1f1b; }
        .font-serif-hk { font-family: 'Noto Serif TC', serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Ê∏ØÂºèÈÖçËâ≤ËÆäÊï∏ */
        :root {
            --hk-red: #D81E05;
            --hk-green: #00584B;
        }

        /* Èô∞ÂΩ±ËàáÁâπÊïà */
        .hk-shadow { box-shadow: 0 4px 15px rgba(0, 88, 75, 0.1); }
        .neon-text { text-shadow: 0 0 10px rgba(255,255,255,0.6); }
        
        /* Tab ÊøÄÊ¥ªÊ®£Âºè */
        .tab-btn-active {
            background-color: white;
            color: var(--hk-green);
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* ‰∫§ÈÄöÈÄ£Êé•Á∑ö */
        .transit-line {
            background-image: linear-gradient(to bottom, #cbd5e1 50%, rgba(255,255,255,0) 0%);
            background-position: left;
            background-size: 2px 10px;
            background-repeat: repeat-y;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        hk: { red: '#D81E05', green: '#00584B', teal: '#4CA695', bg: '#f4f7f6' }
                    }
                }
            }
        }
    </script>
</head>
<body class="text-gray-800 antialiased min-h-screen flex justify-center bg-gray-900">

    <div id="app" class="w-full max-w-md bg-hk-bg min-h-screen relative shadow-2xl flex flex-col overflow-hidden">

        <header class="relative w-full h-[280px] shrink-0 group">
            <div class="absolute inset-0 bg-gradient-to-t from-hk-green/90 via-transparent to-transparent z-10"></div>
            <img src="https://i.imgur.com/G11g0qH.png" class="w-full h-full object-cover object-bottom" alt="Banner">
            
            <div class="absolute bottom-16 left-6 z-20 text-white">
                <h1 class="text-3xl font-serif-hk font-bold tracking-wider neon-text">È¶ôÊ∏ØÊº´ÈÅä</h1>
                <p class="text-sm opacity-90 tracking-[0.3em]">HONG KONG</p>
            </div>

            <div class="absolute bottom-14 right-4 z-50 flex gap-3">
                <button @click="currentTab = 'itinerary'" :class="['w-10 h-10 rounded-full flex items-center justify-center transition-all bg-black/40 text-white backdrop-blur-sm', currentTab === 'itinerary' ? 'tab-btn-active' : '']">
                    <span class="material-icons-outlined text-xl">place</span>
                </button>
                <button @click="currentTab = 'info'" :class="['w-10 h-10 rounded-full flex items-center justify-center transition-all bg-black/40 text-white backdrop-blur-sm', currentTab === 'info' ? 'tab-btn-active' : '']">
                    <span class="material-icons-outlined text-xl">info</span>
                </button>
                <button @click="currentTab = 'shopping'" :class="['w-10 h-10 rounded-full flex items-center justify-center transition-all bg-black/40 text-white backdrop-blur-sm', currentTab === 'shopping' ? 'tab-btn-active' : '']">
                    <span class="material-icons-outlined text-xl">shopping_basket</span>
                </button>
                <button @click="currentTab = 'expenses'" :class="['w-10 h-10 rounded-full flex items-center justify-center transition-all bg-black/40 text-white backdrop-blur-sm', currentTab === 'expenses' ? 'tab-btn-active' : '']">
                    <span class="material-icons-outlined text-xl">payments</span>
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto hide-scrollbar px-4 py-6 pb-24 bg-hk-bg rounded-t-[40px] -mt-10 relative z-30 min-h-[500px]">
            
            <div class="w-12 h-1.5 bg-gray-300/50 rounded-full mx-auto mb-6"></div>

            <div v-if="currentTab === 'itinerary'">
                
                <div class="bg-white p-3 rounded-xl shadow-sm border border-blue-50 flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="text-4xl">{{ getWeatherIcon(currentWeather.type) }}</span>
                        <div>
                            <div class="text-2xl font-bold text-gray-800">{{ currentWeather.temp }}¬∞C</div>
                            <div class="text-xs text-gray-500">È´îÊÑü {{ currentWeather.feelsLike }}¬∞C</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold text-hk-green">È¶ôÊ∏Ø</div>
                        <div class="text-xs text-gray-400">{{ currentDateDisplay }}</div>
                    </div>
                </div>

                <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-4 pb-2">
                    <button v-for="(day, idx) in itineraryDays" :key="idx" 
                        @click="selectedDayIdx = idx"
                        :class="['flex flex-col items-center justify-center min-w-[60px] p-2 rounded-xl border transition-all', 
                        selectedDayIdx === idx ? 'bg-hk-green text-white border-hk-green shadow-md' : 'bg-white text-gray-400 border-gray-100']">
                        <span class="text-xs font-medium">{{ day.week }}</span>
                        <span class="text-xl font-bold">{{ day.date }}</span>
                    </button>
                </div>

                <div class="flex justify-between items-center mb-4">
                    <select v-model="filterCategory" class="bg-white border border-gray-200 text-gray-700 text-sm rounded-lg px-3 py-1.5 focus:outline-none focus:border-hk-green">
                        <option value="all">ÂÖ®È°ØÁ§∫</option>
                        <option value="spot">ÊôØÈªû</option>
                        <option value="food">ÁæéÈ£ü</option>
                        <option value="shop">Ë≥ºÁâ©</option>
                        <option value="stay">‰ΩèÂÆø</option>
                        <option value="flight">Ëà™Áè≠</option>
                    </select>
                </div>

                <div id="itinerary-list" class="space-y-0 pb-10">
                    <div v-for="(item, index) in filteredItinerary" :key="item.id" class="relative group itinerary-item" :data-id="item.id">
                        
                        <div v-if="index > 0" class="pl-8 py-2 flex items-center gap-2 opacity-70">
                            <div class="w-[2px] h-8 bg-gray-300 absolute left-[19px] -top-4"></div> <span class="material-icons-outlined text-gray-400 text-sm">{{ getTransitIcon(item.transitType) }}</span>
                            <span class="text-xs text-gray-500 font-mono bg-gray-100 px-1 rounded">{{ item.transitTime }}</span>
                        </div>
                        <div v-else class="pl-8 py-2 flex items-center gap-2 opacity-70">
                             <span class="material-icons-outlined text-gray-400 text-sm">hotel</span>
                             <span class="text-[10px] text-gray-400">From Hotel</span>
                             <span class="material-icons-outlined text-gray-400 text-xs">arrow_forward</span>
                             <span class="text-xs text-gray-500 font-mono bg-gray-100 px-1 rounded">{{ item.transitTime }}</span>
                        </div>

                        <div @click="openMap(item.name)" class="relative bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:border-hk-green transition-colors cursor-pointer active:scale-[0.99]">
                            <div class="absolute left-[-12px] top-1/2 transform -translate-y-1/2 w-8 h-8 rounded-full border-2 border-white shadow-sm flex items-center justify-center text-white z-10"
                                 :class="getCategoryColor(item.category)">
                                <span class="material-icons-outlined text-sm">{{ getCategoryIcon(item.category) }}</span>
                            </div>

                            <div v-if="item.category === 'flight'" class="flex justify-between items-center">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-2xl font-serif-hk font-bold text-gray-800">{{ item.name.split('-')[0] }}</span>
                                        <span class="material-icons-outlined text-gray-300 rotate-90">flight</span>
                                        <span class="text-2xl font-serif-hk font-bold text-gray-800">{{ item.name.split('-')[1] || 'DEST' }}</span>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-500">
                                        <span>{{ item.startTime }}</span>
                                        <span>{{ item.endTime }}</span>
                                    </div>
                                </div>
                            </div>

                            <div v-else>
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg text-gray-800">{{ item.name }}</h3>
                                    <button @click.stop="editItem(item)" class="text-gray-300 hover:text-hk-green p-1">
                                        <span class="material-icons-outlined text-base">edit</span>
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500 mt-1 space-y-1">
                                    <p v-if="item.openTime" class="flex items-center gap-1">
                                        <span class="material-icons-outlined text-[10px]">schedule</span> {{ item.openTime }}
                                    </p>
                                    <p v-if="item.ticket && item.category === 'spot'" class="flex items-center gap-1 text-hk-red">
                                        <span class="material-icons-outlined text-[10px]">confirmation_number</span> {{ item.ticket }}
                                    </p>
                                    <p v-if="item.note" class="text-gray-600 bg-gray-50 p-1.5 rounded mt-2 border border-dashed border-gray-200">
                                        {{ item.note }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button @click="openAddModal('itinerary')" class="fixed bottom-6 right-6 w-14 h-14 bg-hk-green text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform z-50">
                    <span class="material-icons-outlined text-3xl">add</span>
                </button>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-6 animate-fade-in">
                
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <span class="material-icons-outlined text-hk-teal">currency_exchange</span> ÂåØÁéáÊèõÁÆó (‰ªäÊó•)
                    </h3>
                    <div class="flex items-center gap-3">
                        <div class="flex-1">
                            <label class="text-xs text-gray-400 block mb-1">Ê∏ØÂπ£ (HKD)</label>
                            <input type="number" v-model="exchangeInput" class="w-full bg-gray-50 p-2 rounded border border-gray-200 font-mono text-lg font-bold" placeholder="0">
                        </div>
                        <span class="material-icons-outlined text-gray-400 mt-4">arrow_forward</span>
                        <div class="flex-1">
                            <label class="text-xs text-gray-400 block mb-1">Âè∞Âπ£ (TWD)</label>
                            <div class="w-full bg-hk-bg p-2 rounded border border-transparent font-mono text-lg font-bold text-hk-green">
                                {{ convertedTwd }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-0 rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                    <div class="bg-hk-green/10 p-3 flex items-center gap-2">
                         <span class="material-icons-outlined text-hk-green">flight_takeoff</span>
                         <span class="font-bold text-hk-green">Ëà™Áè≠Ë≥áË®ä</span>
                    </div>
                    <div class="p-4 space-y-4">
                        <div class="flex items-center justify-between border-b border-dashed border-gray-200 pb-3">
                            <div class="text-center w-1/4">
                                <div class="text-2xl font-black text-gray-800">TPE</div>
                                <div class="text-xs text-gray-500">21:35</div>
                            </div>
                            <div class="flex-1 flex flex-col items-center px-2">
                                <div class="text-[10px] text-gray-400">CX408</div>
                                <div class="w-full h-[1px] bg-gray-300 relative my-1">
                                    <span class="absolute -top-1 right-0 w-2 h-2 bg-gray-300 rounded-full"></span>
                                </div>
                                <div class="text-[10px] text-gray-400">2h 10m</div>
                            </div>
                            <div class="text-center w-1/4">
                                <div class="text-2xl font-black text-gray-800">HKG</div>
                                <div class="text-xs text-gray-500">23:45</div>
                            </div>
                        </div>
                         <div class="flex items-center justify-between">
                            <div class="text-center w-1/4">
                                <div class="text-2xl font-black text-gray-800">HKG</div>
                                <div class="text-xs text-gray-500">16:35</div>
                            </div>
                            <div class="flex-1 flex flex-col items-center px-2">
                                <div class="text-[10px] text-gray-400">CX407</div>
                                <div class="w-full h-[1px] bg-gray-300 relative my-1">
                                    <span class="absolute -top-1 right-0 w-2 h-2 bg-gray-300 rounded-full"></span>
                                </div>
                                <div class="text-[10px] text-gray-400">1h 45m</div>
                            </div>
                            <div class="text-center w-1/4">
                                <div class="text-2xl font-black text-gray-800">TPE</div>
                                <div class="text-xs text-gray-500">18:20</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 col-span-2">
                        <h4 class="font-bold text-gray-800 flex items-center gap-1 mb-2">
                            <span class="material-icons-outlined text-hk-red">hotel</span> ‰ΩèÂÆø
                        </h4>
                        <p class="font-bold">Airbnb</p>
                        <p class="text-xs text-gray-500">È¶ôÊ∏ØÂä†ÈÄ£Â®ÅËÄÅÈÅì47Ëôü3Ê®ì</p>
                        <p class="text-xs text-gray-500">Tel: +852 1234 5678</p>
                        <button @click="openMap('È¶ôÊ∏ØÂä†ÈÄ£Â®ÅËÄÅÈÅì47Ëôü')" class="mt-2 text-xs bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-gray-600">Â∞éËà™</button>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <h4 class="font-bold text-gray-800 flex items-center gap-1 mb-2">
                            <span class="material-icons-outlined text-blue-500">local_police</span> Á∑äÊÄ•
                        </h4>
                        <div class="text-sm">
                            <p>Ë≠¶ÂØü: 999</p>
                            <p>ÊïëË≠∑: 999</p>
                        </div>
                    </div>
                    
                     <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <h4 class="font-bold text-gray-800 flex items-center gap-1 mb-2">
                            <span class="material-icons-outlined text-orange-500">directions_car</span> ÁßüËªä
                        </h4>
                        <p class="text-xs text-gray-400">Êú¨Ê¨°ÁÑ°ÁßüËªä</p>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shopping'" class="pb-10">
                <h3 class="text-xl font-serif-hk font-bold mb-4 text-gray-800 ml-1">ÂøÖË≤∑Ê∏ÖÂñÆ</h3>
                
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="(item, index) in shoppingList" :key="index" class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 group relative">
                        <button @click="deleteShoppingItem(index)" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <span class="material-icons-outlined text-sm">close</span>
                        </button>
                        
                        <div class="h-32 bg-gray-100 flex items-center justify-center overflow-hidden">
                            <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                            <span v-else class="material-icons-outlined text-4xl text-gray-300">image</span>
                        </div>
                        <div class="p-3">
                            <h4 class="font-bold text-gray-800 truncate">{{ item.name }}</h4>
                            <div class="flex items-center gap-1 mt-1">
                                <input type="checkbox" v-model="item.bought" class="rounded text-hk-green focus:ring-0">
                                <span class="text-xs text-gray-500" :class="{'line-through': item.bought}">Â∑≤Ë≥ºË≤∑</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="shoppingList.length === 0" class="text-center py-10 text-gray-400">
                    <span class="material-icons-outlined text-4xl mb-2">shopping_bag</span>
                    <p>Ê∏ÖÂñÆÊòØÁ©∫ÁöÑÔºåÂä†ÈªûÊù±Ë•øÂêßÔºÅ</p>
                </div>

                <button @click="openAddModal('shopping')" class="fixed bottom-6 right-6 w-14 h-14 bg-hk-red text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform z-50">
                    <span class="material-icons-outlined text-3xl">add</span>
                </button>
            </div>

            <div v-if="currentTab === 'expenses'" class="pb-10">
                
                <div class="bg-hk-green text-white p-5 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full"></div>
                    <p class="text-sm opacity-80 mb-1">Á∏ΩËä±Ë≤ª (HKD)</p>
                    <h2 class="text-4xl font-mono font-bold">$ {{ totalExpense.toLocaleString() }}</h2>
                    <p class="text-xs opacity-60 mt-2 text-right">Á¥Ñ TWD {{ (totalExpense * exchangeRate).toLocaleString() }}</p>
                </div>

                <div class="space-y-3">
                    <div v-for="(expense, index) in expenses" :key="index" class="bg-white p-4 rounded-xl border border-gray-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-500">
                                <span class="material-icons-outlined">{{ getExpenseIcon(expense.category) }}</span>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">{{ expense.name }}</h4>
                                <div class="text-xs text-gray-400 flex items-center gap-1">
                                    <span>{{ expense.date }}</span> ‚Ä¢ <span class="bg-gray-100 px-1 rounded">{{ expense.payment }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono font-bold text-lg text-hk-green">-{{ expense.amount }}</div>
                            <div class="text-[10px] text-gray-400">{{ expense.category }}</div>
                        </div>
                    </div>
                </div>

                <button @click="openAddModal('expense')" class="fixed bottom-6 right-6 w-14 h-14 bg-yellow-500 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform z-50">
                    <span class="material-icons-outlined text-3xl">add</span>
                </button>
            </div>

        </main>

        <div v-if="showModal" class="fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden p-6 relative">
                <button @click="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800">
                    <span class="material-icons-outlined">close</span>
                </button>
                
                <h3 class="text-xl font-bold mb-4 text-gray-800">{{ modalTitle }}</h3>

                <div v-if="modalType === 'itinerary'" class="space-y-3">
                    <input v-model="form.name" type="text" placeholder="ÂêçÁ®± (e.g., Ëø™Â£´Â∞º)" class="w-full p-2 border rounded bg-gray-50">
                    
                    <div class="grid grid-cols-2 gap-2">
                        <select v-model="form.category" class="w-full p-2 border rounded bg-gray-50">
                            <option value="spot">ÊôØÈªû</option>
                            <option value="food">ÁæéÈ£ü</option>
                            <option value="shop">Ë≥ºÁâ©</option>
                            <option value="stay">‰ΩèÂÆø</option>
                            <option value="flight">Ëà™Áè≠</option>
                            <option value="other">ÂÖ∂‰ªñ</option>
                        </select>
                        <input v-model="form.openTime" type="text" placeholder="ÁáüÊ•≠ÊôÇÈñì" class="w-full p-2 border rounded bg-gray-50">
                    </div>
                    
                    <div v-if="form.category === 'spot'" class="relative">
                         <input v-model="form.ticket" type="text" placeholder="ÈñÄÁ•®ÂÉπÊ†º" class="w-full p-2 border rounded bg-gray-50">
                    </div>

                    <div class="grid grid-cols-2 gap-2 p-2 bg-gray-50 rounded border border-dashed">
                        <div class="col-span-2 text-xs text-gray-400 font-bold">‰∫§ÈÄöË≥áË®ä (Âæû‰∏ä‰∏ÄÁ´ô)</div>
                         <select v-model="form.transitType" class="p-1 border rounded text-sm">
                            <option value="walk">Ê≠•Ë°å</option>
                            <option value="drive">ÈñãËªä</option>
                            <option value="transit">Â§ßÁúæÈÅãËº∏</option>
                        </select>
                        <input v-model="form.transitTime" type="text" placeholder="ÈúÄÊôÇ (e.g. 15min)" class="p-1 border rounded text-sm">
                    </div>

                    <textarea v-model="form.note" placeholder="ÂÇôË®ª / ÁâπËâ≤" class="w-full p-2 border rounded bg-gray-50 h-20"></textarea>

                    <div class="flex gap-2 pt-2">
                        <button v-if="isEditing" @click="confirmDelete" class="flex-1 bg-red-100 text-red-600 py-2 rounded font-bold">Âà™Èô§</button>
                        <button @click="saveItinerary" class="flex-[2] bg-hk-green text-white py-2 rounded font-bold shadow-md">ÂÑ≤Â≠òË°åÁ®ã</button>
                    </div>
                </div>

                <div v-if="modalType === 'shopping'" class="space-y-3">
                    <input v-model="form.name" type="text" placeholder="ÂïÜÂìÅÂêçÁ®±" class="w-full p-2 border rounded bg-gray-50">
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-50 relative">
                        <input type="file" @change="handleImageUpload" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*">
                        <div v-if="form.image" class="h-32 flex justify-center">
                            <img :src="form.image" class="h-full object-contain">
                        </div>
                        <div v-else class="text-gray-400">
                            <span class="material-icons-outlined text-3xl">add_a_photo</span>
                            <p class="text-xs">ÈªûÊìä‰∏äÂÇ≥ÂúñÁâá</p>
                        </div>
                    </div>
                    <button @click="saveShopping" class="w-full bg-hk-red text-white py-2 rounded font-bold mt-2 shadow-md">Âä†ÂÖ•Ê∏ÖÂñÆ</button>
                </div>

                <div v-if="modalType === 'expense'" class="space-y-3">
                    <div class="flex gap-2 mb-2 overflow-x-auto pb-1">
                        <button v-for="cat in ['È£≤È£ü','‰∫§ÈÄö','Ë≥ºÁâ©','ÈñÄÁ•®','‰ΩèÂÆø','ÂÖ∂‰ªñ']" 
                                @click="form.category = cat"
                                :class="['px-3 py-1 rounded-full text-xs font-bold border whitespace-nowrap', form.category === cat ? 'bg-yellow-500 text-white border-yellow-500' : 'bg-white text-gray-500 border-gray-200']">
                            {{ cat }}
                        </button>
                    </div>
                    <input v-model="form.name" type="text" placeholder="È†ÖÁõÆÂêçÁ®±" class="w-full p-2 border rounded bg-gray-50">
                    <div class="relative">
                         <span class="absolute left-3 top-2.5 text-gray-400 font-mono">$</span>
                         <input v-model.number="form.amount" type="number" placeholder="ÈáëÈ°ç (HKD)" class="w-full pl-6 p-2 border rounded bg-gray-50 font-bold">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <select v-model="form.date" class="w-full p-2 border rounded bg-gray-50">
                            <option v-for="d in itineraryDays" :value="d.date">{{ d.date }}</option>
                        </select>
                        <select v-model="form.payment" class="w-full p-2 border rounded bg-gray-50">
                            <option value="ÁèæÈáë">ÁèæÈáë</option>
                            <option value="‰ø°Áî®Âç°">‰ø°Áî®Âç°</option>
                        </select>
                    </div>
                    <button @click="saveExpense" class="w-full bg-yellow-500 text-white py-2 rounded font-bold mt-2 shadow-md">Ë®òÂ∏≥</button>
                </div>

            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    currentTab: 'itinerary',
                    selectedDayIdx: 0,
                    filterCategory: 'all',
                    exchangeRate: 4.1, // È†êË®≠ÂåØÁéá
                    exchangeInput: '',
                    
                    // Ê®°Êì¨Â§©Ê∞£Êï∏Êìö
                    weatherMock: {
                        "11": { type: "cloud", temp: 19, feelsLike: 18 },
                        "12": { type: "sun", temp: 22, feelsLike: 23 },
                        "13": { type: "rain", temp: 18, feelsLike: 16 },
                        "14": { type: "cloud", temp: 20, feelsLike: 19 },
                        "15": { type: "sun", temp: 21, feelsLike: 20 }
                    },

                    itineraryDays: [
                        { date: "12/11", week: "Wed" },
                        { date: "12/12", week: "Thu" },
                        { date: "12/13", week: "Fri" },
                        { date: "12/14", week: "Sat" },
                        { date: "12/15", week: "Sun" }
                    ],

                    // Ë≥áÊñôÂ≠òÂÑ≤ (ÊúÉÂæû localStorage ËÆÄÂèñ)
                    itineraryData: [], 
                    shoppingList: [],
                    expenses: [],

                    // Modal Áõ∏Èóú
                    showModal: false,
                    modalType: '', // 'itinerary', 'shopping', 'expense'
                    isEditing: false,
                    editId: null,
                    form: {
                        name: '', category: 'spot', openTime: '', ticket: '', 
                        note: '', image: null, amount: '', payment: 'ÁèæÈáë', 
                        date: '12/11', transitType: 'transit', transitTime: '20 min'
                    }
                }
            },
            computed: {
                currentDateDisplay() {
                    const d = this.itineraryDays[this.selectedDayIdx];
                    return `2025 ${d.date} ${d.week}`;
                },
                currentWeather() {
                    const dateKey = this.itineraryDays[this.selectedDayIdx].date.split('/')[1];
                    return this.weatherMock[dateKey] || { type: "sun", temp: 22, feelsLike: 22 };
                },
                convertedTwd() {
                    if(!this.exchangeInput) return 0;
                    return Math.round(this.exchangeInput * this.exchangeRate).toLocaleString();
                },
                // Ê†πÊìöÊó•ÊúüËàáÁØ©ÈÅ∏Âô®È°ØÁ§∫Ë°åÁ®ã
                filteredItinerary() {
                    const targetDate = this.itineraryDays[this.selectedDayIdx].date;
                    let list = this.itineraryData.filter(item => item.date === targetDate);
                    if (this.filterCategory !== 'all') {
                        list = list.filter(item => item.category === this.filterCategory);
                    }
                    return list; // È†ÜÂ∫èÂ∑≤Á∂ìÁî± sortable Âú®ÂéüÂßã array ‰∏≠ÊîπËÆäÔºåÈÄôË£°Áõ¥Êé•È°ØÁ§∫Âç≥ÂèØ
                },
                totalExpense() {
                    return this.expenses.reduce((sum, item) => sum + (Number(item.amount) || 0), 0);
                }
            },
            mounted() {
                // ÂàùÂßãÂåñË≥áÊñô (Âæû LocalStorage ËÆÄÂèñÊàñ‰ΩøÁî®È†êË®≠)
                this.loadFromStorage();

                // ÂàùÂßãÂåñ SortableJS
                this.$nextTick(() => {
                    this.initSortable();
                });
            },
            watch: {
                // Áï∂ Tab ÂàáÊèõÊàñÊó•ÊúüÂàáÊèõÊôÇÔºåÈáçÊñ∞ÂàùÂßãÂåñÊãñÊõ≥ÂäüËÉΩ (Âõ†ÁÇ∫ DOM ËÆä‰∫Ü)
                currentTab() { this.$nextTick(() => this.initSortable()); },
                selectedDayIdx() { this.$nextTick(() => this.initSortable()); },
                filterCategory() { this.$nextTick(() => this.initSortable()); },
                
                // Ëá™ÂãïÂÑ≤Â≠ò
                itineraryData: { handler() { this.saveToStorage() }, deep: true },
                shoppingList: { handler() { this.saveToStorage() }, deep: true },
                expenses: { handler() { this.saveToStorage() }, deep: true }
            },
            methods: {
                initSortable() {
                    const el = document.getElementById('itinerary-list');
                    if (el && this.filterCategory === 'all') { // Âè™ÊúâÂú®Ê≤íÁØ©ÈÅ∏ÊôÇÊâçËÉΩÊéíÂ∫èÔºåÈÅøÂÖçÈÇèËºØÊ∑∑‰∫Ç
                        new Sortable(el, {
                            animation: 150,
                            onEnd: (evt) => {
                                // ÈáçÊñ∞ÊéíÂ∫è Vue Ë£°ÁöÑË≥áÊñô
                                const targetDate = this.itineraryDays[this.selectedDayIdx].date;
                                const dayItems = this.itineraryData.filter(item => item.date === targetDate);
                                const otherItems = this.itineraryData.filter(item => item.date !== targetDate);
                                
                                // ÁßªÂãïÂÖÉÁ¥†
                                const item = dayItems.splice(evt.oldIndex, 1)[0];
                                dayItems.splice(evt.newIndex, 0, item);
                                
                                // Âêà‰ΩµÂõû‰∏ªÈô£Âàó
                                this.itineraryData = [...otherItems, ...dayItems];
                            }
                        });
                    }
                },
                
                // --- Ë°åÁ®ãÁõ∏Èóú ---
                openAddModal(type) {
                    this.modalType = type;
                    this.isEditing = false;
                    this.showModal = true;
                    this.resetForm();
                    // Ë®≠ÂÆöÈ†êË®≠Êó•ÊúüÁÇ∫Áï∂ÂâçÈÅ∏ÊìáÊó•Êúü
                    this.form.date = this.itineraryDays[this.selectedDayIdx].date;
                },
                editItem(item) {
                    this.modalType = 'itinerary';
                    this.isEditing = true;
                    this.editId = item.id;
                    this.form = { ...item }; // Ë§áË£ΩÁâ©‰ª∂
                    this.showModal = true;
                },
                saveItinerary() {
                    if(!this.form.name) return alert('Ë´ãËº∏ÂÖ•ÂêçÁ®±');
                    
                    if (this.isEditing) {
                        const idx = this.itineraryData.findIndex(i => i.id === this.editId);
                        if (idx !== -1) this.itineraryData[idx] = { ...this.form, id: this.editId };
                    } else {
                        this.itineraryData.push({
                            ...this.form,
                            id: Date.now(),
                            date: this.itineraryDays[this.selectedDayIdx].date
                        });
                    }
                    this.closeModal();
                },
                confirmDelete() {
                    if(confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãË°åÁ®ãÂóéÔºü")) {
                        this.itineraryData = this.itineraryData.filter(i => i.id !== this.editId);
                        this.closeModal();
                    }
                },
                
                // --- Ë≥ºÁâ©ËàáËä±Ë≤ª ---
                handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.form.image = e.target.result; // Base64
                        };
                        reader.readAsDataURL(file);
                    }
                },
                saveShopping() {
                    if(!this.form.name) return alert('Ë´ãËº∏ÂÖ•ÂïÜÂìÅÂêçÁ®±');
                    this.shoppingList.push({
                        name: this.form.name,
                        image: this.form.image,
                        bought: false
                    });
                    this.closeModal();
                },
                deleteShoppingItem(index) {
                    if(confirm("Âà™Èô§Ê≠§ÂïÜÂìÅÔºü")) this.shoppingList.splice(index, 1);
                },
                saveExpense() {
                    if(!this.form.name || !this.form.amount) return alert('Ë´ãËº∏ÂÖ•ÂÆåÊï¥Ë≥áË®ä');
                    this.expenses.push({
                        category: this.form.category || 'ÂÖ∂‰ªñ',
                        name: this.form.name,
                        amount: this.form.amount,
                        date: this.form.date,
                        payment: this.form.payment
                    });
                    this.closeModal();
                },

                // --- Â∑•ÂÖ∑ ---
                closeModal() { this.showModal = false; },
                resetForm() {
                    this.form = {
                        name: '', category: 'spot', openTime: '', ticket: '', 
                        note: '', image: null, amount: '', payment: 'ÁèæÈáë', 
                        date: this.itineraryDays[this.selectedDayIdx].date,
                        transitType: 'transit', transitTime: '20 min'
                    };
                },
                openMap(location) {
                    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ' È¶ôÊ∏Ø')}`;
                    window.open(url, '_blank');
                },
                getCategoryColor(cat) {
                    const map = { spot: 'bg-hk-green', food: 'bg-hk-red', shop: 'bg-blue-500', stay: 'bg-purple-500', flight: 'bg-gray-600', other: 'bg-gray-400' };
                    return map[cat] || 'bg-gray-400';
                },
                getCategoryIcon(cat) {
                    const map = { spot: 'camera_alt', food: 'restaurant', shop: 'shopping_bag', stay: 'hotel', flight: 'flight', other: 'star' };
                    return map[cat] || 'place';
                },
                getTransitIcon(type) {
                    const map = { walk: 'directions_walk', drive: 'directions_car', transit: 'directions_bus' };
                    return map[type] || 'arrow_downward';
                },
                getWeatherIcon(type) {
                    const map = { sun: '‚òÄÔ∏è', cloud: '‚òÅÔ∏è', rain: 'üåßÔ∏è', snow: '‚ùÑÔ∏è' };
                    return map[type] || 'üå§Ô∏è';
                },
                getExpenseIcon(cat) {
                    const map = { 'È£≤È£ü': 'restaurant', '‰∫§ÈÄö': 'directions_bus', 'Ë≥ºÁâ©': 'shopping_bag', 'ÈñÄÁ•®': 'confirmation_number', '‰ΩèÂÆø': 'hotel' };
                    return map[cat] || 'paid';
                },

                // --- ÂÑ≤Â≠òÊ©üÂà∂ ---
                saveToStorage() {
                    localStorage.setItem('hk_itinerary', JSON.stringify(this.itineraryData));
                    localStorage.setItem('hk_shopping', JSON.stringify(this.shoppingList));
                    localStorage.setItem('hk_expenses', JSON.stringify(this.expenses));
                },
                loadFromStorage() {
                    const i = localStorage.getItem('hk_itinerary');
                    const s = localStorage.getItem('hk_shopping');
                    const e = localStorage.getItem('hk_expenses');
                    
                    if(i) this.itineraryData = JSON.parse(i);
                    else {
                        // È†êË®≠Ë≥áÊñô (Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°Èñã)
                        this.itineraryData = [
                             { id: 1, date: "12/11", category: "flight", name: "TPE-HKG", startTime: "21:35", endTime: "23:45", transitType: "transit", transitTime: "Start" },
                             { id: 2, date: "12/11", category: "spot", name: "Ê©üÂ†¥Â∑¥Â£´ A21", note: "ÂæÄÂ∏ÇÂçÄ", transitType: "walk", transitTime: "10 min" },
                             { id: 3, date: "12/11", category: "stay", name: "Airbnb Âä†ÈÄ£Â®ÅËÄÅÈÅì", note: "Check-in", transitType: "transit", transitTime: "45 min" }
                        ];
                    }
                    if(s) this.shoppingList = JSON.parse(s);
                    if(e) this.expenses = JSON.parse(e);
                }
            }
        }).mount('#app')
    </script>
</body>
</html>

